<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Pets</title>
  <link rel="stylesheet" href="../styles/sidebar.css">
  <link rel="stylesheet" href="../styles/global.css">
  <link rel="stylesheet" href="../styles/users.css"> <!-- same styling as users page -->
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <side-bar></side-bar>

    <!-- Main Content -->
    <div class="main">
      <section id="pets">
        <h1>Pets</h1>

        <!-- Controls -->
        <div class="controls">
          <input type="text" id="searchInput" placeholder="Search by name, breed or owner...">
          <select id="speciesFilter">
            <option value="">All Species</option>
            <option value="Dog">Dog</option>
            <option value="Cat">Cat</option>
            <option value="Bird">Bird</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <!-- Pets Table -->
        <table id="petTable">
          <thead>
            <tr>
              <th>Pet ID</th>
              <th>Pet Name</th>
              <th>Type</th>
              <th>Breed</th>
              <th>Age</th>
              <th>Owner</th>
              <th>Health Status</th>
              <th>Comment</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Pets will be loaded from Firebase -->
          </tbody>
        </table>
      </section>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content:center; align-items:center;">
    <div style="background:#fff; padding:20px; border-radius:8px; width:400px; position:relative;">
      <h2>Edit Pet</h2>
      <form id="editForm">
        <label>Pet Name</label>
        <input type="text" id="editPetName" required>
        <label>Type</label>
        <select id="editType" required>
          <option value="Dog">Dog</option>
          <option value="Cat">Cat</option>
          <option value="Bird">Bird</option>
          <option value="Other">Other</option>
        </select>
        <label>Breed</label>
        <input type="text" id="editBreed" required>
        <label>Age</label>
        <input type="number" id="editAge" min="0" required>
        <label>Owner</label>
        <input type="text" id="editOwner" required>
        <label>Health Status</label>
        <input type="text" id="editHealth" required>
        <label>Comment</label>
        <textarea id="editComment" rows="3" placeholder="Enter notes or comments here"></textarea>
        <div style="margin-top:15px; text-align:right;">
          <button type="button" id="cancelEdit">Cancel</button>
          <button type="submit">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase config
    const firebaseConfig = {
       apiKey: "BOQout55yLWUT_u5i4RUnKn7YWjdEVomWAjCkXz3IvTaVVkeCdDEa1TNOlfwKp_9ywtk9N8_xWSesl1MeJQMJbI",
      authDomain: "fitfurs12.firebaseapp.com",
      projectId: "fitfurs12",
      storageBucket: "fitfurs12.appspot.com",
      messagingSenderId: "875211703765",
      appId: "1:875211703765:android:b069bfa50ec424172c295c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const tableBody = document.querySelector('#petTable tbody');
    const searchInput = document.getElementById('searchInput');
    const speciesFilter = document.getElementById('speciesFilter');

    // Load pets from Firebase
    function loadPets() {
      tableBody.innerHTML = '';
      db.collection('pets').get().then(snapshot => {
        snapshot.forEach(doc => {
          const pet = doc.data();
          const row = document.createElement('tr');
          row.setAttribute('data-id', doc.id);

          row.innerHTML = `
            <td>${doc.id}</td>
            <td>${pet.name || ''}</td>
            <td>${pet.type || ''}</td>
            <td>${pet.breed || ''}</td>
            <td>${pet.age || ''}</td>
            <td>${pet.owner || ''}</td>
            <td>${pet.healthStatus || ''}</td>
            <td>${pet.comment || ''}</td>
            <td>
              <button class="edit-btn">Edit</button>
              <button class="delete-btn">Delete</button>
            </td>
          `;
          tableBody.appendChild(row);
        });
      });
    }

    loadPets();

    // Search & filter
    function filterPets() {
      const searchValue = searchInput.value.toLowerCase();
      const speciesValue = speciesFilter.value;
      for (let row of tableBody.rows) {
        const name = row.cells[1].textContent.toLowerCase();
        const breed = row.cells[3].textContent.toLowerCase();
        const owner = row.cells[5].textContent.toLowerCase();
        const type = row.cells[2].textContent;

        const matchesSearch = name.includes(searchValue) || breed.includes(searchValue) || owner.includes(searchValue);
        const matchesSpecies = !speciesValue || type === speciesValue;

        row.style.display = (matchesSearch && matchesSpecies) ? '' : 'none';
      }
    }

    searchInput.addEventListener('input', filterPets);
    speciesFilter.addEventListener('change', filterPets);

    // Edit & Delete
    const editModal = document.getElementById('editModal');
    const editForm = document.getElementById('editForm');
    let currentRow;

    tableBody.addEventListener('click', (e) => {
      const row = e.target.closest('tr');
      const docId = row.getAttribute('data-id');

      if (e.target.classList.contains('edit-btn')) {
        currentRow = row;
        document.getElementById('editPetName').value = row.cells[1].textContent;
        document.getElementById('editType').value = row.cells[2].textContent;
        document.getElementById('editBreed').value = row.cells[3].textContent;
        document.getElementById('editAge').value = row.cells[4].textContent;
        document.getElementById('editOwner').value = row.cells[5].textContent;
        document.getElementById('editHealth').value = row.cells[6].textContent;
        document.getElementById('editComment').value = row.cells[7].textContent;
        editModal.style.display = 'flex';

        editForm.onsubmit = (ev) => {
          ev.preventDefault();
          db.collection('pets').doc(docId).update({
            name: document.getElementById('editPetName').value,
            type: document.getElementById('editType').value,
            breed: document.getElementById('editBreed').value,
            age: Number(document.getElementById('editAge').value),
            owner: document.getElementById('editOwner').value,
            healthStatus: document.getElementById('editHealth').value,
            comment: document.getElementById('editComment').value
          }).then(() => {
            editModal.style.display = 'none';
            loadPets();
          });
        };
      }

      if (e.target.classList.contains('delete-btn')) {
        if (confirm('Are you sure you want to delete this pet?')) {
          db.collection('pets').doc(docId).delete().then(() => {
            loadPets();
          });
        }
      }
    });

    document.getElementById('cancelEdit').addEventListener('click', () => {
      editModal.style.display = 'none';
    });
  </script>

  <script type="module" src="../main.js" defer></script>
</body>
</html>
